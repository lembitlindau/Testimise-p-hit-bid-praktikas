<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automaatsed Testid - ÃœliÃµpilaste Haldamise SÃ¼steem</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #495057;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        #runTests {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            display: block;
            margin: 0 auto 30px;
            font-weight: bold;
        }
        #runTests:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ§ª Automaatsed Testid</h1>
        
        <button id="runTests">KÃ¤ivita KÃµik Testid</button>
        
        <div class="stats" id="testStats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalTests">0</div>
                <div>Teste Kokku</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passedTests">0</div>
                <div>LÃ¤bitud</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failedTests">0</div>
                <div>EbaÃµnnestunud</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div>Edukus</div>
            </div>
        </div>

        <div class="test-section" id="unitTests">
            <h2>ðŸ“‹ Ãœhikutestid</h2>
            <div id="unitTestResults"></div>
        </div>

        <div class="test-section" id="integrationTests">
            <h2>ðŸ”— Integratsioonitestid</h2>
            <div id="integrationTestResults"></div>
        </div>

        <div class="test-section" id="performanceTests">
            <h2>âš¡ JÃµudlustestid</h2>
            <div id="performanceTestResults"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        class TestRunner {
            constructor() {
                this.results = {
                    passed: 0,
                    failed: 0,
                    total: 0
                };
                this.sms = null;
            }

            async runAllTests() {
                this.showInfo('Testide kÃ¤ivitamine algas...');
                this.clearResults();
                
                // Loo testimiseks puhas sÃ¼steem
                this.sms = new StudentManagementSystem();
                
                // KÃ¤ivita erinevad testikategooriad
                await this.runUnitTests();
                await this.runIntegrationTests();
                await this.runPerformanceTests();
                
                this.showTestStatistics();
                this.showInfo('KÃµik testid lÃµpetatud!');
            }

            clearResults() {
                this.results = { passed: 0, failed: 0, total: 0 };
                document.getElementById('unitTestResults').innerHTML = '';
                document.getElementById('integrationTestResults').innerHTML = '';
                document.getElementById('performanceTestResults').innerHTML = '';
            }

            async runUnitTests() {
                this.showInfo('KÃ¤ivitan Ã¼hikuteste...');
                
                // Test 1: E-maili valideerimine
                this.test(
                    'UT-001: E-maili valideerimise funktsioon - kehtiv e-mail',
                    () => this.sms.validateEmail('test@ut.ee'),
                    true,
                    'unitTestResults'
                );

                this.test(
                    'UT-002: E-maili valideerimise funktsioon - kehtetu e-mail',
                    () => this.sms.validateEmail('kehtetu-email'),
                    false,
                    'unitTestResults'
                );

                // Test 2: ÃœliÃµpilaskoodi valideerimine
                this.test(
                    'UT-003: ÃœliÃµpilaskoodi valideerimise funktsioon - kehtiv kood',
                    () => this.sms.validateStudentId('123456'),
                    true,
                    'unitTestResults'
                );

                this.test(
                    'UT-004: ÃœliÃµpilaskoodi valideerimise funktsioon - kehtetu kood',
                    () => this.sms.validateStudentId('12345A'),
                    false,
                    'unitTestResults'
                );

                // Test 3: Nime valideerimine
                this.test(
                    'UT-005: Nime valideerimise funktsioon - kehtiv nimi',
                    () => this.sms.validateName('Mari Tamm'),
                    true,
                    'unitTestResults'
                );

                this.test(
                    'UT-006: Nime valideerimise funktsioon - liiga lÃ¼hike nimi',
                    () => this.sms.validateName('A'),
                    false,
                    'unitTestResults'
                );

                // Test 4: Keskmise hinde arvutamine
                this.sms.grades = [
                    { value: 3.0 },
                    { value: 4.0 },
                    { value: 5.0 }
                ];
                
                this.test(
                    'UT-007: Keskmise hinde arvutamine - mitme hinde korral',
                    () => Math.abs(this.sms.calculateAverageGrade() - 4.0) < 0.01,
                    true,
                    'unitTestResults'
                );

                this.sms.grades = [];
                this.test(
                    'UT-008: Keskmise hinde arvutamine - tÃ¼hja andmebaasi korral',
                    () => this.sms.calculateAverageGrade(),
                    0,
                    'unitTestResults'
                );

                // Test 5: LÃ¤bimisprotsendi arvutamine
                this.sms.grades = [
                    { value: 2.0 },
                    { value: 3.0 },
                    { value: 4.0 },
                    { value: 5.0 }
                ];
                
                this.test(
                    'UT-009: LÃ¤bimisprotsendi arvutamine',
                    () => this.sms.calculatePassPercentage(),
                    75,
                    'unitTestResults'
                );
            }

            async runIntegrationTests() {
                this.showInfo('KÃ¤ivitan integratsiooniteste...');
                
                // Puhasta andmed
                this.sms.students = [];
                this.sms.grades = [];
                
                // Test 1: ÃœliÃµpilase lisamine
                const originalStudentCount = this.sms.students.length;
                
                // Simuleeri Ã¼liÃµpilase lisamist
                const testStudent = {
                    id: Date.now(),
                    firstName: "Test",
                    lastName: "Kasutaja",
                    email: "test@ut.ee",
                    studentId: "123456",
                    registrationDate: new Date().toISOString().split('T')[0]
                };
                
                this.sms.students.push(testStudent);
                
                this.test(
                    'IT-001: ÃœliÃµpilase lisamine sÃ¼steemi',
                    () => this.sms.students.length,
                    originalStudentCount + 1,
                    'integrationTestResults'
                );

                // Test 2: Hinde lisamine ja seostamine
                const testGrade = {
                    id: Date.now(),
                    studentId: testStudent.id,
                    subject: "Test Aine",
                    value: 4.5,
                    date: new Date().toISOString().split('T')[0]
                };
                
                this.sms.grades.push(testGrade);
                
                const studentGrades = this.sms.grades.filter(g => g.studentId === testStudent.id);
                
                this.test(
                    'IT-002: Hinde seostamine Ã¼liÃµpilasega',
                    () => studentGrades.length,
                    1,
                    'integrationTestResults'
                );

                this.test(
                    'IT-003: Hinde vÃ¤Ã¤rtuse kontroll',
                    () => studentGrades[0].value,
                    4.5,
                    'integrationTestResults'
                );

                // Test 3: Statistika arvutamine
                const avgGrade = this.sms.calculateAverageGrade();
                
                this.test(
                    'IT-004: Statistika uuendamine pÃ¤rast andmete lisamist',
                    () => avgGrade > 0,
                    true,
                    'integrationTestResults'
                );

                // Test 4: LocalStorage simulatsioon
                this.test(
                    'IT-005: LocalStorage funktsioonide olemasolu',
                    () => typeof this.sms.saveToStorage === 'function' && 
                          typeof this.sms.loadFromStorage === 'function',
                    true,
                    'integrationTestResults'
                );
            }

            async runPerformanceTests() {
                this.showInfo('KÃ¤ivitan jÃµudlusteste...');
                
                // Test 1: Suure andmehulga lisamine
                const startTime = performance.now();
                
                // Lisa 100 Ã¼liÃµpilast
                for (let i = 0; i < 100; i++) {
                    const student = {
                        id: Date.now() + i,
                        firstName: `Test${i}`,
                        lastName: `Kasutaja${i}`,
                        email: `test${i}@ut.ee`,
                        studentId: String(100000 + i),
                        registrationDate: new Date().toISOString().split('T')[0]
                    };
                    this.sms.students.push(student);
                }
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                this.test(
                    'PT-001: 100 Ã¼liÃµpilase lisamine (aeg < 100ms)',
                    () => duration < 100,
                    true,
                    'performanceTestResults'
                );

                // Test 2: Keskmise hinde arvutamine suurel andmehulgal
                // Lisa igale Ã¼liÃµpilasele 5 hinnet
                for (let i = 0; i < 100; i++) {
                    for (let j = 0; j < 5; j++) {
                        const grade = {
                            id: Date.now() + i * 1000 + j,
                            studentId: this.sms.students[i].id,
                            subject: `Aine${j}`,
                            value: Math.random() * 4 + 1, // 1-5
                            date: new Date().toISOString().split('T')[0]
                        };
                        this.sms.grades.push(grade);
                    }
                }
                
                const avgStartTime = performance.now();
                const avgGrade = this.sms.calculateAverageGrade();
                const avgEndTime = performance.now();
                const avgDuration = avgEndTime - avgStartTime;
                
                this.test(
                    'PT-002: Keskmise hinde arvutamine 500 hindel (aeg < 50ms)',
                    () => avgDuration < 50,
                    true,
                    'performanceTestResults'
                );

                this.test(
                    'PT-003: Keskmise hinde mÃµistlik vÃ¤Ã¤rtus',
                    () => avgGrade >= 1 && avgGrade <= 5,
                    true,
                    'performanceTestResults'
                );

                // Test 3: Otsingu jÃµudlus
                const searchStartTime = performance.now();
                const searchResults = this.sms.students.filter(student => 
                    student.firstName.toLowerCase().includes('test'));
                const searchEndTime = performance.now();
                const searchDuration = searchEndTime - searchStartTime;
                
                this.test(
                    'PT-004: Otsingu jÃµudlus 100 Ã¼liÃµpilase hulgas (aeg < 10ms)',
                    () => searchDuration < 10,
                    true,
                    'performanceTestResults'
                );

                this.test(
                    'PT-005: Otsingu tulemuste arv',
                    () => searchResults.length,
                    100,
                    'performanceTestResults'
                );
            }

            test(name, testFunction, expected, containerId) {
                this.results.total++;
                
                try {
                    const result = testFunction();
                    const passed = result === expected;
                    
                    if (passed) {
                        this.results.passed++;
                        this.showResult(name, 'LÃ„BITUD', 'test-pass', containerId);
                    } else {
                        this.results.failed++;
                        this.showResult(
                            name, 
                            `EBAÃ•NNESTUS - Oodati: ${expected}, Saadi: ${result}`, 
                            'test-fail', 
                            containerId
                        );
                    }
                } catch (error) {
                    this.results.failed++;
                    this.showResult(
                        name, 
                        `VIGA: ${error.message}`, 
                        'test-fail', 
                        containerId
                    );
                }
            }

            showResult(testName, result, className, containerId) {
                const container = document.getElementById(containerId);
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${className}`;
                resultDiv.innerHTML = `<strong>${testName}:</strong> ${result}`;
                container.appendChild(resultDiv);
            }

            showInfo(message) {
                console.log(message);
            }

            showTestStatistics() {
                const { total, passed, failed } = this.results;
                const successRate = total > 0 ? Math.round((passed / total) * 100) : 0;
                
                document.getElementById('totalTests').textContent = total;
                document.getElementById('passedTests').textContent = passed;
                document.getElementById('failedTests').textContent = failed;
                document.getElementById('successRate').textContent = successRate + '%';
                
                document.getElementById('testStats').style.display = 'grid';
                
                console.log(`Testitulemused: ${passed}/${total} lÃ¤bitud (${successRate}%)`);
            }
        }

        // KÃ¤ivita testid, kui leht on laaditud
        document.addEventListener('DOMContentLoaded', () => {
            const testRunner = new TestRunner();
            
            document.getElementById('runTests').addEventListener('click', () => {
                testRunner.runAllTests();
            });
        });
    </script>
</body>
</html>
